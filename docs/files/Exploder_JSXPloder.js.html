<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Exploder/JSXPloder.js - JSXPath - xpath query language for JSON documents</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="JSXPath - xpath query language for JSON documents" width="117" height="52">JSXPath - xpath query language for JSON documents</h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.2.9</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/JSXAxisTokens.html">JSXAxisTokens</a></li>
                                <li><a href="../classes/JSXOperatorTokens.html">JSXOperatorTokens</a></li>
                                <li><a href="../classes/JSXPath.html">JSXPath</a></li>
                                <li><a href="../classes/JSXPathFunctions.html">JSXPathFunctions</a></li>
                                <li><a href="../classes/JSXProcessor.html">JSXProcessor</a></li>
                                <li><a href="../classes/JSXReplacer.html">JSXReplacer</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/JSXPath.html">JSXPath</a></li>
                                <li><a href="../modules/Parser.html">Parser</a></li>
                                <li><a href="../modules/Processor.html">Processor</a></li>
                                <li><a href="../modules/Tokens.html">Tokens</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: Exploder/JSXPloder.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
var JSXAxisTokens = require(&quot;../Tokens/JSXAxisTokens&quot;);
var JSXDebugConfig = require(&quot;../JSXDebugConfig&quot;);

class JSXPloder {
	constructor() {
		this.ContextTokens = new JSXAxisTokens();
		this.json = {};
		this.currentContexts = []; //stores current array before 
		this.DEBUG = JSXDebugConfig.debugOn;
		this.SHOW_EXPLODE = JSXDebugConfig.showExplode;
	}

	contextList() {
		return this.currentContexts;
	}

	current() {
		return this.json[&quot;.&quot;];
	}

	axis() {
		object.keys(this.ContextTokens.tokens);
	}

	processAxis(psAxis, paArgs) {
		oResult = this.ContextTokens.tokens[key].apply(this, [this.json, this._explode()]);
		return oResult;
	}

	setCurrentToChildNode(psName) {
		if (psName === &quot;@&quot; || psName === &quot;*&quot;) { //do nothing
		} else if (Object.keys(this.ContextTokens.tokens[&quot;*&quot;](this.json)).indexOf(psName) &gt; -1) {
			this.updateCurrent({ 
				name: psName, 
				parent: this.json[&quot;.&quot;].name 
			});
		} else {
			if (this.DEBUG &amp;&amp; this.SHOW_EXPLODE) console.log(new Date(), &quot;JSXPloder:setCurrentToChildNode: creating error node&quot;, psName);
			this.createErrorNode();
		}
		// return this.json[&quot;.&quot;];
	}

	setParentAsCurrent(){
		let oParent = this.ContextTokens.tokens[&quot;..&quot;](this.json);
		let sParentKey = Object.keys(oParent)[0];
		this.updateCurrent({
			name: sParentKey, 
			parent: oParent[sParentKey].parent
		});
	}

	addCurrentContext() {
		this.currentContexts.push(Object.assign( {}, this.json[&quot;.&quot;]));
	}

	resetCurrentContext() {
		if (this.currentContexts.length === 0) {
			throw new Error(&quot;thrown in triggerCurrentNodesReset, no node item to reference to.&quot;)
		}
		let resetTo = this.currentContexts[this.currentContexts.length-1];
		this.updateCurrent({ 
			name: resetTo.name, 
			parent: resetTo.parent
		});
	}

	removeCurrentContext() {
		if (this.currentContexts.length === 0) {
			throw new Error(&quot;thrown in triggerTestsEnd, cannot pop an empty list.&quot;);
		}
		let popped = this.currentContexts.pop();
		this.updateCurrent({
			name: popped.name, 
			parent: popped.parent
		});
	}

	createErrorNode() {
		this.json[&quot;.&quot;] = {
			name: &quot;#ERR&quot;,
			parent: null,
			value: [],
			children: []
		}
	}
	/**
	 * explode the input json
	 * @param  {object} poInput  the input json
	 * @param  {boolean} [internal] [description]
	 * @return {object}          [description]
	 */
	explode(poInput) {
		if ([&quot;string&quot;, &quot;number&quot;, null, undefined].indexOf(typeof poInput) &gt; -1)
			throw new Error(&quot;Input data is not a valid JSON data.&quot;);

		if (Array.isArray(poInput)) {
			this._explodeArray(poInput, &quot;@&quot;, this.json);
		} else { 
			this._explodeObject(poInput, &quot;@&quot;, this.json);
		}

		this._setDefaultProperties(poInput);

		return this.json;
	}

	_explode() {//used by JSXAxisTokens&#x27; descendant and descendant-or-self
		var self = this;
		return (poInput) =&gt; {
			var oRef = {};
			if (Array.isArray(poInput)) {
				self._explodeArray(poInput, &quot;@&quot;, oRef);
			} else { 
				self._explodeObject(poInput, &quot;@&quot;, oRef);
			}
			return oRef;
		}
	}

	reset() {
		this.updateCurrent(&quot;@&quot;, null);
		this.currentContexts.length = 0;
	}

	updateCurrent(poParam) {
		if (poParam.name) {
			this._updateCurrentToNode(poParam.name, poParam.parent);
		} else if (Array.isArray(poParam.values)) {
			this._updateCurrentToNodes(poParam.values)
		}		
	}

	_updateCurrentToNode(psName, psParent) {
		if (!this.json.hasOwnProperty(psName))
			throw new Error(&quot;Key &quot; + psName + &quot; does not exists.&quot;)
		
		if (Array.isArray(this.json[psName])) {
			for (var i = 0; i &lt; this.json[psName].length; ++i) {
				if (psParent === this.json[psName][i].parent) {
					this.json[&quot;.&quot;] = this.json[psName][i];
					break;
				}
			}
		} else if (psParent === this.json[psName].parent) {
			this.json[&quot;.&quot;] = this.json[psName];
		}
		this._updateChildren();
	}

	_updateCurrentToNodes(paValues) {
		let sName = null;
		for (let i = 0; i &lt; paValues.length; ++i) {
			if (paValues[i].name &amp;&amp; sName !== undefined) {
				if (sName !== null &amp;&amp; sName !== paValues[i].name) {
					sName = undefined;
				} else {
					sName = paValues[i].name;
				}
			}
		}

		this.json[&quot;.&quot;] = {
			name: sName,
			value: paValues,
			parent: null,
			children: []
		}
	}

	// _onCurrentNodeChange() {
	// 	for (let key in this.ContextTokens.tokens) {
	// 		this.json[key] = this.ContextTokens.tokens[key].apply(this, [this.json, this._explode()]);
	// 	}
	// }

	_updateChildren() {
		this.json[&quot;*&quot;] = this.ContextTokens.tokens[&quot;*&quot;](this.json);
	}

	_explodeObject(poInput, psParent, poRef) {
		if (!Array.isArray(poInput)) {
			for (var key in poInput) {
				var prop = this._createProperty(key, poInput[key], psParent)
				if (poRef.hasOwnProperty(key)) {
					if (Array.isArray(poRef[key])){
						poRef[key].push(prop);
					} else {
						var aValue = [];
						aValue.push(poRef[key]);
						aValue.push(prop);
						poRef[key] = aValue;
					}
				} else {
					poRef[key] = prop;
				}

				//work through the children
				if (Array.isArray(poInput[key])) {
					this._explodeArray(poInput[key], key, poRef);
				} else if (null !== poInput[key] &amp;&amp; &quot;object&quot; === typeof poInput[key]) {
					this._explodeObject(poInput[key], key, poRef);
				}
			}
		}
	}

	_explodeArray(paInput, psParent, poRef) {
		var self = this;
		if (Array.isArray(paInput)) {
			paInput.forEach(function(e){
				if (Array.isArray(e)) {
					self._explodeArray(e, psParent, poRef);
				} else if (e !== null &amp;&amp; typeof e) {
					self._explodeObject(e, psParent, poRef);
				}
			});
		}
	}

	_setDefaultProperties(poInput) {
		this.json[&quot;@&quot;] = this._createProperty(&quot;@&quot;, poInput, null);
		this.json[&quot;.&quot;] = this.json[&quot;@&quot;];
		// this._onCurrentNodeChange(this.json);
	}

	_createProperty(psName, pValue, psParent) {
		var children = [];
		if (Array.isArray(pValue)) {
			pValue.forEach(function(e){
				if (null !== e &amp;&amp; &quot;object&quot; === typeof e) {
					var eKeys = Object.keys(e);
					eKeys.forEach(function(c){
						if (children.indexOf(c) === -1) {
							children.push(c);
						}
					});
				}
			});
		} else if (null !== pValue &amp;&amp; &quot;object&quot; === typeof pValue) {
			children = Object.keys(pValue);
		}
		return {
			name: psName,
			value: pValue,
			parent: psParent,
			children: children
		}
	}
}

module.exports = JSXPloder;
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
